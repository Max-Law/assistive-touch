const t={position:"fixed",top:"10px",left:"10px"},e={width:"30px",height:"30px",border:"1px solid rgba(128,128,128,.8)",cursor:"pointer",borderRadius:"50%",opacity:.9,backgroundColor:"#f4f4f5"},i={width:"220px",height:"220px",backgroundColor:"#666",opacity:.8,background:"#000",borderRadius:"15px",padding:"10px",gridTemplateColumns:"repeat(3, 1fr)",gridTemplateRows:"repeat(3, 1fr)",gridGap:"10px"},s={width:"60px",height:"60px",fontSize:"12px",color:"#fff"},n={width:"40px",height:"40px",margin:"0 10px"},a={width:"100%",textAlign:"center",lineHeight:"14px",display:"inline-block"},h=[[0,0,0,0,1,0,0,0,0],[0,0,0,1,0,2,0,0,0],[0,1,0,2,0,3,0,0,0],[0,1,0,2,0,3,0,4,0],[0,1,0,2,0,3,4,0,5],[0,1,0,2,0,3,4,5,6],[1,0,2,3,0,4,5,6,7],[1,2,3,4,0,5,6,7,8],[1,2,3,4,5,6,7,8,9]],o=(t,e="",i="")=>{const s=document.createElement(t);return s.className=e,s.innerHTML=i,s},l=(t,e)=>{for(let i in e)t.style[i]=e[i];return t},r=(t,e,i="click",s=!1)=>{t.addEventListener(i,(t=>{const i=t.target;e(i)}),{passive:!1,once:s})},d=(t=0,e=0)=>Math.min(Math.max(0,t),e);class A{constructor(s={}){var n;this.isMobile=!!navigator.userAgent.match(/AppleWebKit.*Mobile.*/),this.default={boxStyle:Object.assign(t,{top:s.top,left:s.left}),btnStyle:Object.assign(e,s.btnStyle),layerStyle:Object.assign(i,s.layerStyle),menus:s.menus||[]},this.btnState=(n=(t,e)=>{"active"==t&&this.handleBtnActive(e)},new Proxy({active:null,hadMove:!1,isDragging:!1,initialX:0,initialY:0,limitX:0,limitY:0},{get:(t,e,i)=>t[e],set:(t,e,i,s)=>(t[e]=i,n&&n(e,i),!0)})),this.BOX=null,this.BUTTON=null,this.DISPLAY_LAYER=null,this.init()}init(){Array.isArray(this.default.menus)?(this.render(),this.btnState.active=!1,this.bindAllEvent()):console.error("menus 必须为数组")}render(){const t=document.createDocumentFragment();this.BOX=l(o("div","AssistiveTouchBox"),this.default.boxStyle),this.BUTTON=l(o("div","AssistiveTouch"),this.default.btnStyle),this.DISPLAY_LAYER=l(o("div","DisplayLayer"),this.default.layerStyle),this.createMenuDom(this.handleMenus(this.default.menus)),this.BOX.appendChild(this.BUTTON),this.BOX.appendChild(this.DISPLAY_LAYER),t.appendChild(this.BOX),document.body.appendChild(t)}createMenuDom(t){const e=document.createDocumentFragment();this.DISPLAY_LAYER.innerHTML="",t.forEach((i=>{const h=l(o("div","DisplayLayer-item"),s),d=l(o("img","DisplayLayer-item-logo"),n),A=l(o("span","DisplayLayer-item-label"),a),{hide:c,icon:p,title:g,children:u,callback:m}=i;c?h.style.opacity="0":h.style.cursor="pointer",d.src=p,d.alt=g,A.innerText=g,h.appendChild(d),h.appendChild(A),r(h,(()=>{if(u&&Array.isArray(u)){const e=this.handleMenus(u);e.splice(4,1,{title:"返回上级",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAqpJREFUeF7tm2tuwyAQhM3J2pyszcmSnoxmLZCQA2b2ER62I/VHVQeYj9ldwNQtJ/+4k+tfLgAWDvDefy/LQj+Lc+7Xos1Wbagd4L0nwT/JgG/OuWcrAdp+VAAy4mk895lcIAIQLE+zvtp+8zk2gCD+sWO94wIoWP4cDvDe06znLH9sAJV4z0UCVYA7mp17V4zdJAhaHtVaey5Ce7aEUgTQWHwOzgrk0yU1C2AA8c3yyhuAAcWnMMxLbA6ArwVr57+bQsgBQMtdZw42S+5SDjgNhJGrAOowVUiMtA5ABWdLprRcVneDwObnrWS9lsyc84C4vE7PFCQwROcQVQBxJIzyKLZk6IO6lMJgQ4AB0KhACGIACex4xMYFQcvoG8c+LAABAg2udBhieiIEAt/qZbmADQAICbUDUkUSCO6VEVEXwA/mGmx1JihJxGhVUAEouIFlQXSmuE5AXWACABWhfY5xKkVdQRMxFYCQhNHNGlQRZgSwfRFTNBYSBtMBYLqgGgazAkB3q9WSPCsAWoztvZyJYVHNAxcAbWnq8X3GwuiYDuAkwlolmDIETg/g9CFwAXi/llPKxYddB6D7geMBYNgf2hFOVwU45wK1EkiEpgLAEY/eVrsA9FjKSvpkzj5drIAmF3pIMmDL73DFo/afIgcIxMOzPzQAwe20aLpq7U/dOWQISGY9iGKJH8oBihmHT39yecnEAWHw1D5ykzQdx1f4hfu9nJbqAag5AINZsyoWbOvHjlUOYL6psRK7bUcsXpUDFInKEoTI9iZVwL8IWCphtrVeyLa4UywKAeaWlKmt+rjK8tvWRQCokQ7xbzbrViEAv6Sszun+Ax8RblUFPgWBRP/RdTuLON/jKw6BtFFlRYh3ClfBa2lq+H+HJgCUFu/69QtAV/wDdP4Pk3lCUDkn+qIAAAAASUVORK5CYII=",callback:()=>{this.createMenuDom(t)}}),this.createMenuDom(e)}else m&&m()})),e.appendChild(h)})),this.DISPLAY_LAYER.appendChild(e)}handleMenus(t){const e=t.length;if(0==e||!h[e-1])return void console.error("menus 数量不正确!");let i=[];return h[e-1].forEach((e=>{0==e?i.push({title:"占位菜单",icon:"",hide:!0}):i.push(t[e-1])})),i}handleBtnActive(t){t?(this.BUTTON.hidden=!0,this.DISPLAY_LAYER.style.display="grid",this.btnState.limitX=window.innerWidth-this.DISPLAY_LAYER.offsetWidth-1,this.btnState.limitY=window.innerHeight-this.DISPLAY_LAYER.offsetHeight-1):(this.BUTTON.hidden=!1,this.DISPLAY_LAYER.style.display="none",this.btnState.limitX=window.innerWidth-this.BUTTON.offsetWidth-1,this.btnState.limitY=window.innerHeight-this.BUTTON.offsetHeight-1),this.checkLimit(this.BOX.offsetLeft,this.BOX.offsetTop)}checkLimit(t=0,e=0){const i=d(t,this.btnState.limitX),s=d(e,this.btnState.limitY);this.BOX.style.left=i+"px",this.BOX.style.top=s+"px"}bindAllEvent(){this.bindDraggingEvent(),r(this.BUTTON,(()=>{this.btnState.hadMove||(this.btnState.active=!0)})),r(document,(t=>{const{className:e}=t;this.btnState.active&&"AssistiveTouch"!==e&&"DisplayLayer"!==e&&"DisplayLayer-item"!==e&&"DisplayLayer-item-logo"!==e&&"DisplayLayer-item-label"!==e&&(this.btnState.active=!1)}))}bindDraggingEvent(){let t;t=this.isMobile?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},this.BOX.addEventListener(t.start,(i=>{this.btnState.hadMove=!1,this.btnState.isDragging=!0,this.btnState.initialX=this.isMobile?i.touches[0].radiusX+i.target.offsetLeft:i.offsetX+i.target.offsetLeft,this.btnState.initialY=this.isMobile?i.touches[0].radiusY+i.target.offsetTop:i.offsetY+i.target.offsetTop,document.addEventListener(t.move,e,{passive:!1}),document.addEventListener(t.end,(()=>{this.btnState.isDragging=!1,document.removeEventListener(t.move,e)}),{passive:!1,once:!0})}),{passive:!1});const e=t=>{let e=this.isMobile?t.touches[0].clientX:t.clientX,i=this.isMobile?t.touches[0].clientY:t.clientY;this.btnState.hadMove=!0,!0===this.btnState.isDragging&&this.checkLimit(e-this.btnState.initialX,i-this.btnState.initialY)}}}export{A as default};
/*!【Assistive Touch JS】v1.0.0 | MIT License | https://gitee.com/max_law/assistive-touch-js.git */
